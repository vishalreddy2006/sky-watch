<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkyWatch Error Detector</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1e293b;
            color: white;
            padding: 20px;
        }
        .error-container {
            background: #dc2626;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .success-container {
            background: #16a34a;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .loading-container {
            background: #ca8a04;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: 2px solid #374151;
            border-radius: 8px;
            background: white;
        }
        .btn {
            background: #3b82f6;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
    </style>
</head>
<body>
    <h1>🔍 SkyWatch Error Detection</h1>
    
    <div id="status" class="loading-container">
        🔄 Testing SkyWatch app...
    </div>

    <button class="btn" onclick="testApp()">🔄 Reload Test</button>
    <button class="btn" onclick="openInNewTab()">🌐 Open in New Tab</button>
    <button class="btn" onclick="checkConsole()">🐛 Check Console</button>

    <h2>📱 App Preview:</h2>
    <iframe id="app-frame" src="/" onload="handleLoad()" onerror="handleError()"></iframe>

    <div id="console-logs"></div>

    <script>
        let loadAttempts = 0;
        
        function handleLoad() {
            loadAttempts++;
            const iframe = document.getElementById('app-frame');
            const status = document.getElementById('status');
            
            try {
                // Check if iframe loaded successfully
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                if (iframeDoc && iframeDoc.readyState === 'complete') {
                    status.className = 'success-container';
                    status.innerHTML = '✅ SkyWatch app loaded successfully! (Attempt ' + loadAttempts + ')';
                    
                    // Check for React errors in iframe
                    setTimeout(checkIframeErrors, 2000);
                } else {
                    status.className = 'loading-container';
                    status.innerHTML = '⏳ App still loading... (Attempt ' + loadAttempts + ')';
                }
            } catch (e) {
                handleError('Cross-origin access blocked: ' + e.message);
            }
        }
        
        function handleError(error = 'Unknown error') {
            const status = document.getElementById('status');
            status.className = 'error-container';
            status.innerHTML = '❌ SkyWatch app failed to load: ' + error;
            
            // Try alternative approaches
            setTimeout(() => {
                if (loadAttempts < 3) {
                    testApp();
                }
            }, 3000);
        }
        
        function testApp() {
            const iframe = document.getElementById('app-frame');
            const status = document.getElementById('status');
            
            status.className = 'loading-container';
            status.innerHTML = '🔄 Reloading SkyWatch app...';
            
            // Force reload
            iframe.src = '/?t=' + Date.now();
        }
        
        function openInNewTab() {
            window.open('/', '_blank');
        }
        
        function checkConsole() {
            const logs = document.getElementById('console-logs');
            logs.innerHTML = `
                <div style="background: #374151; padding: 15px; border-radius: 8px; margin-top: 20px;">
                    <h3>🐛 Debug Instructions:</h3>
                    <p>1. Press <strong>F12</strong> to open Developer Tools</p>
                    <p>2. Go to <strong>Console</strong> tab</p>
                    <p>3. Look for red error messages</p>
                    <p>4. Check <strong>Network</strong> tab for failed requests</p>
                    <p>5. If you see errors, copy them and share with me!</p>
                </div>
            `;
        }
        
        function checkIframeErrors() {
            try {
                const iframe = document.getElementById('app-frame');
                const iframeWindow = iframe.contentWindow;
                
                // Try to detect React errors
                if (iframeWindow && iframeWindow.console) {
                    console.log('✅ React app appears to be running in iframe');
                }
            } catch (e) {
                console.log('Cannot access iframe content due to CORS');
            }
        }
        
        // Global error handler
        window.onerror = function(message, source, lineno, colno, error) {
            const status = document.getElementById('status');
            status.className = 'error-container';
            status.innerHTML = '❌ JavaScript Error: ' + message;
            return false;
        };
        
        // Test connection to server
        fetch('/')
            .then(response => {
                if (response.ok) {
                    console.log('✅ Server connection successful');
                } else {
                    throw new Error('Server responded with: ' + response.status);
                }
            })
            .catch(error => {
                const status = document.getElementById('status');
                status.className = 'error-container';
                status.innerHTML = '❌ Server connection failed: ' + error.message;
            });
    </script>
</body>
</html>